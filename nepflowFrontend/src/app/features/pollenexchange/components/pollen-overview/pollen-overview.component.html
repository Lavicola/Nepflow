<app-filterbox (filteredElements)="onFiltered($event)" [offerContainers$]="otherPollenOffers$"></app-filterbox>

<div *ngFor="let container of filteredPollenOffers$|async">
  <div class="date-header">
    <h2>Pollen Offers in: {{ container.date }}</h2>
  </div>
  <mat-grid-list cols="2" gutterSize="5px">
    <mat-grid-tile *ngFor="let offer of container.pollenOffers" class="pollen-offer-tile">
      <mat-card class="pollen-offer-card">
        <mat-card-header>
          <mat-card-title>{{ offer.nepenthesName || 'No Name' }}</mat-card-title>
          <mat-card-subtitle>Location: {{ offer.location || 'Unknown' }}</mat-card-subtitle>
        </mat-card-header>
        <mat-card-content>
          <img mat-card-lg-image
               [src]="offer.imageLocation || 'assets/placeholder.jpg'"
               alt="{{ offer.nepenthesName }}">
          <p><strong>Origin:</strong> {{ offer.seller || 'N/A' }}</p>
          <p><strong>Location:</strong> {{ offer.location || 'N/A' }}</p>
          <p><strong>Sex:</strong> {{ offer.sex || 'N/A' }}</p>
          <p><strong>Searching since:</strong> {{ offer.pollenOfferOpenedDate || 'N/A' }}</p>
          <p><strong>User:</strong> {{ offer.user?.username + "("+offer.user?.country+")" || 'No User' }}</p>
          <ng-container *ngIf="user.username">
            <mat-form-field>
              <mat-label>Select an option</mat-label>
              <mat-select [(value)]="selectedOwnOffer">
                <ng-container *ngFor="let myOffer of myPollenOffers$|async ">
                  <ng-container *ngIf="myOffer.sex != offer.sex">
                    <ng-container
                      *ngIf="offer.id && myOffer.id && lookup.has(offer.id) && lookup.get(offer.id)?.has(myOffer.id) ; then tradeExists; else ignore"></ng-container>
                  </ng-container>
                  <ng-template #tradeExists>
                    <mat-option disabled="" *ngIf="offer.id && myOffer.id && lookup.has(offer.id)" [value]="myOffer">
                      <s>{{ lookup.get(offer.id)?.get(myOffer.id)?.nepenthesName  }} </s>
                    </mat-option>
                  </ng-template>
                  <ng-template #ignore>
                    <mat-option *ngIf="offer.id && myOffer.id" [value]="myOffer">
                      {{ myOffer.nepenthesName  }}
                    </mat-option>
                  </ng-template>
                </ng-container>
              </mat-select>
            </mat-form-field>
            <button (click)="createTrade(offer)" mat-raised-button>Basic</button>
          </ng-container>
        </mat-card-content>
      </mat-card>
    </mat-grid-tile>
  </mat-grid-list>

</div>
